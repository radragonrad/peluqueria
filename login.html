<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Iniciar sesión - Peluquería</title>
  <link rel="stylesheet" href="css/style.css" />
  <!-- Cargar Vue.js desde CDN -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>
<body>
  <div id="app" class="container">
    <h2>{{ modo === 'login' ? 'Iniciar sesión' : 'Crear cuenta' }}</h2>

    <!-- Formulario dinámico -->
    <form @submit.prevent="modo === 'login' ? iniciarSesion() : registrarse()">
      <input 
        type="email" 
        v-model="email" 
        placeholder="Correo electrónico" 
        required 
        class="input-field"
      />
      <input 
        type="password" 
        v-model="password" 
        placeholder="Contraseña (mín. 6 caracteres)" 
        minlength="6" 
        required 
        class="input-field"
      />

      <button type="submit" class="btn" :disabled="cargando">
        {{ cargando ? 'Procesando...' : (modo === 'login' ? 'Entrar' : 'Crear cuenta') }}
      </button>
    </form>

    <!-- Mensaje de error -->
    <p v-if="error" class="error">{{ error }}</p>

    <!-- Cambiar modo -->
    <p class="toggle">
      {{ modo === 'login' ? '¿No tienes cuenta?' : '¿Ya tienes cuenta?' }}
      <a href="#" @click.prevent="cambiarModo">{{ modo === 'login' ? 'Regístrate' : 'Inicia sesión' }}</a>
    </p>
  </div>

  <script>
    const { createApp, ref } = Vue;

    createApp({
      setup() {
        const modo = ref('login'); // 'login' o 'registro'
        const email = ref('');
        const password = ref('');
        const cargando = ref(false);
        const error = ref('');

        const cambiarModo = () => {
          modo.value = modo.value === 'login' ? 'registro' : 'login';
          error.value = '';
        };

        const registrarse = async () => {
          cargando.value = true;
          error.value = '';

          try {
            const res = await fetch('./backend/api/auth.php', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                action: 'register',
                email: email.value,
                password: password.value
              })
            });

            const data = await res.json();

            if (res.ok) {
              alert('¡Cuenta creada! Ahora puedes iniciar sesión.');
              modo.value = 'login';
              email.value = '';
              password.value = '';
            } else {
              error.value = data.message || 'Error al registrar.';
            }
          } catch (err) {
            error.value = 'No se pudo conectar al servidor.';
            console.error(err);
          } finally {
            cargando.value = false;
          }
        };

        const iniciarSesion = async () => {
          // Lo implementaremos después; por ahora solo registro
          alert('Función de login aún no implementada.');
        };

        return {
          modo,
          email,
          password,
          cargando,
          error,
          cambiarModo,
          registrarse,
          iniciarSesion
        };
      }
    }).mount('#app');
  </script>
</body>
</html>